<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>{{template.name}}</title>
    <meta name="description" content="{{template.preview}}" />

    <meta property="og:title" content="Vertex 360 | {{template.name}}" />
  	<meta property="og:type" content="article" />
  	<meta property="og:url" content="https://www.vertex360.co/template/{{template.slug}}" />
  	<meta property="og:image" content="{{{template.image}}}=s260-c" />
  	<meta property="og:image:width" content="260px" />
  	<meta property="og:image:height" content="260px" />
  	<meta property="og:description" content="{{template.preview}}" />

    {{>styles}}
    <style>
			.logo {
				width: 160px;
			}

      .icon-avatar {
        border-radius: 50%;
        margin-right: 6px;
        padding: 4px;
        border: 1px solid #56b48c;
      }

      .author-container {
        display: flex;
        border-top: 1px solid #ddd;
        margin-top: 40px;
        padding: 20px 0px
      }

      .author-container h3 {
        text-transform: capitalize;
      }

      .template-header {
        background: #fff;
        padding: 24px;
      }

      .template-header small {
        font-size: 14px;
      }

      .template-header p {
        margin-bottom: 0px;
        line-height: 2.0;
        font-size: 18px;
      }

      .screenshot {
        margin-bottom: 24px;
        max-width: 100%;
        border: 1px solid #ddd;
        padding: 3px;
        background: #fff;
      }

      .bg-green {
        background: #56b48c;
        border-color: #56b48c;
      }

      .btn-get-started {
        width: 100%;
        border-radius: 4px;
        padding: 12px 11em;
      }

      @media (max-width: 768px) {
        .btn-get-started {
          padding: 12px 5.5em;
        }
      }

		</style>
</head>
    <body>
      {{>nav}}

        <!-- features section -->
        <section class="py-6" id="features" style="background:#f9f9f9">
            <div class="container mt-4">
                <div class="row">
                    <div class="col-md-10 col-lg-8 mx-auto">
                        <div class="template-header">
                          <h1>{{template.name}} Template</h1>
                          <img class="icon-avatar" src="{{{template.profile.image}}}=s34-c" />
                          <small>{{template.profile.username}}</small>
                          <span style="margin:16px">&bull;</span>
                          <small><a style="color:red" target="_blank" href="https://{{template.slug}}.vertex360.co">Live Example</a></small>
                          <hr />
                          <img style="max-width:100%;margin-bottom:20px" src="{{{template.image}}}=s1024" />
                          <p class="mb-5">{{{template.description}}}</p>
                          <h3>Screenshots</h3>
                          {{#template.images}}
                          <a target="_blank" href="{{{.}}}=s1024">
                            <img class="screenshot" src="{{{.}}}=s512" />
                          </a>
                          {{/template.images}}

                          <a href="#" data-toggle="modal" data-target="#launch-template-modal" class="btn btn-primary d-inline-flex flex-row align-items-center text-white btn-lg btn-get-started bg-green">
                              Launch This Template
                          </a>
                        </div>

                        <div class="author-container">
                          <div style="">
                            <img class="icon-avatar" src="{{{template.profile.image}}}=s48-c" />
                          </div>
                          <div style="flex:1;padding-left:12px">
                            <h3>{{template.profile.firstName}} {{template.profile.lastName}}</h3>
                            <p class="text-muted">{{template.profile.bio}}</p>
                          </div>
                        </div>
                    </div>
                </div>

            </div>
        </section>

        <div class="modal fade" id="launch-template-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog" role="document">
            <div class="modal-content" style="border-radius:4px">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Launch Template</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
                <img style="max-width:100%" src="{{{template.image}}}=s750" />
                <p class="text-center mt-4">To launch this template on your account and update its configuration with your content, enter the name of your site below.</p>
                <hr />
              </div>
              <div id="btn-launch-container" class="modal-footer pt-0">
                <input style="background:#fffffa" class="form-control" type="text" id="input-site-name" placeholder="Your Site Name" />
                <button id="btn-launch-template" type="button" class="btn btn-primary">Launch!</button>
              </div>
              <div class="text-center" style="padding:1.5rem">
                <img style="width:160px" src="https://lh3.googleusercontent.com/hlcLdauNL9UiLa3K4wF5ZPNpHzi50R26y61Ahx7oRMbUNgujN-1SmeC_3zG4EHLBH5WnRhQ1ZS19KF_xcWqkTKoENw=s320" />
              </div>
            </div>
          </div>
        </div>

        {{>register}}
        {{>footer}}
        {{>scripts}}
        <script>
          (function(){
            // Mustache.tags = ["<%", "%>"] // change delimiter so it doesn't conflict server side
            var data = window.__PRELOADED__
            var selected = data.template
            var user = data.user
            // var query = data.query // query params

            // checks if a template is ready when cloning:
            var checkTemplate = function(siteSlug){
              var body = {template:siteSlug}
              window.vertexLib.postRequest('/account/check-template', body, function(err, response){
                if (err){
                  // console.log('TEMPLATE NOT READY: ' + siteSlug)
                  setTimeout(function(){
                    checkTemplate(siteSlug)
                  }, 4000)
                  return
                }

                if (response.confirmation != 'success'){
                  setTimeout(function(){
                    checkTemplate(siteSlug)
                  }, 4000)
                  return
                }

                // console.log('CHECK TEMPLATE: ' + JSON.stringify(response))
                if (response.confirmation != 'success'){
                  alert('Error - ' + response.message)
                  return
                }

                // window.location.href = '/me?selected=sites' // redirect to account page
                window.location.href = '/admin/'+siteSlug // redirect to site admin page
              })
            }

            var launchTemplate = function(){
              var body = {
                name: $('#input-site-name').val().trim(), // this needs to be entered by the user,
                source: selected.id // ID of the template being copied
              }

              if (body.name.length == 0){
                alert('Please enter a name for your site')
                return
              }

              $('#btn-launch-container').html("<img style='width:100px' src='https://storage.turbo360.co/vertex360-cms-4hujkc/loader.gif' /><br /><em style='color:#888'>Launching your site. This may take up to 2 minutes...</em>")
              window.vertexLib.postRequest('/account/launch-template', body, function(err, response){
                if (err){
                  alert('Error: ' + err.message)
                  return
                }

                console.log('SITE LAUNCHED: ' + JSON.stringify(response))
                setTimeout(function(){
                  checkTemplate(response.data.slug)
                }, 4000)
              })
            }

            $('#btn-launch-template').click(function(event){
              if (event)
                event.preventDefault()

              if (user == null){
                alert('Please log in or register to clone this site.')
                return
              }

              launchTemplate()
            })

          })()
        </script>
    </body>
</html>
