<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Vertex 360</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://lh3.googleusercontent.com/5SVrpLI9utkuVJbQb48cpD3tar59mgWaWSAM73Ghj8dxFJMD2UOzkhO5ptWDd2uV2eqgSvDCSa-Ad8aOrygXx6nv=s32-c" rel="icon" type="image/png" />
    <link href="https://fonts.googleapis.com/css?family=Rubik:300,400,400i,500" rel="stylesheet">

    <link href="{{{cdn}}}/wingman/css/socicon.css" rel="stylesheet" type="text/css" media="all" />
    <link href="{{{cdn}}}/wingman/css/entypo.css" rel="stylesheet" type="text/css" media="all" />
    <link href="{{{cdn}}}/wingman/css/theme.css" rel="stylesheet" type="text/css" media="all" />
</head>

<body>

<div class="main-container">

    <section>
        <div class="container">
            <div class="row justify-content-center text-center section-intro">
                <div class="col-12 col-md-9 col-lg-8">
                    <h2 class="display-4 font-oswald text-capitalize">Launch {{template.name}} With Hosting</h2>
                    <p class="lead">
                        Launch {{template.name}} on your own account today and create a beautfiful portfolio website in under an hour!
                        Less than $5 per month for the a 1-year commitment.
                    </p>
                </div>
                <!--end of col-->
            </div>
            <!--end of row-->

            <div class="tab-content">
                <div class="tab-pane fade show active" id="pricing-monthly" role="tab">
                    <div class="row">
                        <div class="col-md-6 col-lg-4 offset-md-2">
                            <div class="card pricing card-lg">
                                <div class="card-body">
                                    <span class="display-3 price-collapse collapse show mt-0 mb-2">$30</span>
                                    <span>6 MONTHS</span>
                                    <hr>
                                    <span class="h6">Includes:</span>
                                    <ul class="list-unstyled" style="height:160px">
                                        <li>
                                            Hosting
                                        </li>
                                        <li>
                                            Custom Domain
                                        </li>
                                        <li>
                                            Blog
                                        </li>
                                        <li>
                                            Automatic SSL
                                        </li>
                                        <li>
                                            Contact Form
                                        </li>
                                    </ul>
                                    <a id="btn-launch-30" href="#" class="btn btn-info mt-0 w-100 mb-4">LAUNCH YOUR SITE</a>
                                </div>
                            </div>
                            <!--end card-->
                        </div>
                        <!--end of col-->
                        <div class="col-md-6 col-lg-4">
                            <div class="card pricing card-lg">
                                <div class="card-body">
                                    <span class="display-3 mt-0 mb-2">$50</span>
                                    <span>12 MONTHS</span>
                                    <hr>
                                    <span class="h6">Includes:</span>
                                    <ul class="list-unstyled" style="height:160px">
                                        <li>
                                            Hosting
                                        </li>
                                        <li>
                                            Custom Domain
                                        </li>
                                        <li>
                                            Blog
                                        </li>
                                        <li>
                                            Automatic SSL
                                        </li>
                                        <li>
                                            Contact Form
                                        </li>
                                    </ul>
                                    <a id="btn-launch-50" href="#" class="btn btn-success mt-0 w-100 mb-4">LAUNCH YOUR SITE</a>
                                </div>
                            </div>
                        </div>

                    </div>
                    <!--end of row-->
                </div>

            </div>
            <!--end of tab content-->

        </div>
        <!--end of container-->
    </section>


</div>

<div class="modal fade" id="register-modal" tabindex="-1" role="dialog" aria-labelledby="registerModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content" style="border-radius:4px;max-width:300px;margin:auto">
      <div class="modal-header text-center">
        <img class="mx-auto mt-1 mb-2" style="width:130px" src="https://lh3.googleusercontent.com/hlcLdauNL9UiLa3K4wF5ZPNpHzi50R26y61Ahx7oRMbUNgujN-1SmeC_3zG4EHLBH5WnRhQ1ZS19KF_xcWqkTKoENw=s260" />
      </div>
      <div class="modal-body">
        <div class="text-center mb-3">
          <h4>Join</h4>
        </div>
        <input id="input-register-name" style="background:#f9f9f9;border:none;padding:0.5125rem 1rem" class="form-control mb-2" type="text" placeholder="Name" />
        <input id="input-register-email" style="background:#f9f9f9;border:none;padding:0.5125rem 1rem" class="form-control mb-2" type="text" placeholder="Email" />
        <input id="input-register-password" style="background:#f9f9f9;border:none;padding:0.5125rem 1rem" class="form-control mb-3" type="password" placeholder="Password" />
        <div style="text-align:center">
          <small>Already have an account? Sign in <a id="href-show-login" style="color:red" href="#">HERE</a></small>
        </div>
        <hr />
        <div style="text-align:center">
            <h4 id="register-price-header" class="mb-2">$30 per 6 months</h4>
        </div>
        <div style="text-align:center" id="paypal-button-register"></div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="login-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content" style="border-radius:4px;max-width:300px;margin:auto">
      <div class="modal-header text-center">
        <img class="mx-auto mt-1 mb-2" style="width:130px" src="https://lh3.googleusercontent.com/hlcLdauNL9UiLa3K4wF5ZPNpHzi50R26y61Ahx7oRMbUNgujN-1SmeC_3zG4EHLBH5WnRhQ1ZS19KF_xcWqkTKoENw=s260" />
      </div>
      <div class="modal-body">
        <div class="text-center mb-3">
          <h4>Log In</h4>
        </div>
        <input id="input-login-email" style="background:#f9f9f9;border:none;padding:0.5125rem 1rem" class="form-control mb-2" type="text" placeholder="Email" />
        <input id="input-login-password" style="background:#f9f9f9;border:none;padding:0.5125rem 1rem" class="form-control mb-3" type="password" placeholder="Password" />
        <hr />
        <button id="input-login" style="width:100%" type="button" class="btn btn-primary btn-lg mb-1">LOG IN</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="purchase-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content" style="border-radius:4px;max-width:300px;margin:auto">
      <div class="modal-header text-center">
        <img class="mx-auto mt-1 mb-2" style="width:130px" src="https://lh3.googleusercontent.com/hlcLdauNL9UiLa3K4wF5ZPNpHzi50R26y61Ahx7oRMbUNgujN-1SmeC_3zG4EHLBH5WnRhQ1ZS19KF_xcWqkTKoENw=s260" />
      </div>
      <div class="modal-body">
        <div class="text-center mb-3">
          <h4 class="mb-3">LAUNCH WEBSITE</h4>
          <p>Upgrade to Premium to access <strong>ALL</strong> tutorials on Turbo 360 as well as all future tutorials forever!</p>
          <h4 id="upgrade-price-modal" class="mb-0 text-blue">$30 per 6 months</h4>
        </div>
        <hr />
        <div id="paypal-button"></div>
      </div>
    </div>
  </div>
</div>

<a id="btn-register-modal" data-toggle="modal" data-target="#register-modal" href="#" style="display:none"></a>
<a id="btn-purchase-modal" data-toggle="modal" data-target="#purchase-modal" href="#" style="display:none"></a>
<a id="activate-pp-button" href="#" style="display:none"></a>


    <script type="text/javascript">window.__PRELOADED__ = {{{preloaded}}}</script>
    <script type="text/javascript" src="{{{cdn}}}/scripts/vertex-lib.js"></script>
    <script type="text/javascript" src="{{{cdn}}}/wingman/js/jquery.min.js"></script>
    <script type="text/javascript" src="{{{cdn}}}/wingman/js/popper.min.js"></script>
    <script type="text/javascript" src="{{{cdn}}}/wingman/js/jquery.smartWizard.min.js"></script>
    <script type="text/javascript" src="{{{cdn}}}/wingman/js/flickity.pkgd.min.js"></script>
    <script type="text/javascript" src="{{{cdn}}}/wingman/js/scrollMonitor.js"></script>
    <script type="text/javascript" src="{{{cdn}}}/wingman/js/smooth-scroll.polyfills.js"></script>
    <script type="text/javascript" src="{{{cdn}}}/wingman/js/prism.js"></script>
    <script type="text/javascript" src="{{{cdn}}}/wingman/js/zoom.min.js"></script>
    <script type="text/javascript" src="{{{cdn}}}/wingman/js/bootstrap.js"></script>
    <script type="text/javascript" src="{{{cdn}}}/wingman/js/theme.js"></script>
    <script type="text/javascript" src="https://www.paypal.com/sdk/js?client-id={{pp_client_id}}&disable-funding=credit&disable-card=amex,discover"></script>

    <script>
        (function(){
            var preloaded = window.__PRELOADED__
            var currentUser = preloaded.user // null if not registered
            var template = preloaded.template
            var amount = {num:200, str:'2.00'}
            var buttons = [
                {id:'paypal-button-register', type:'register'},
                {id:'paypal-button', type:'currentuser'}
            ]

            var purchaseSite = function(price){
                if (currentUser != null){
                    console.log('current user: '+JSON.stringify(currentUser))
                    document.getElementById('btn-purchase-modal').click()
                    return
                }

                // console.log('current user: '+JSON.stringify(currentUser))
                document.getElementById('btn-register-modal').click()
            }

            $('#btn-launch-30').click(function(e){
                if (e)
                    e.preventDefault()
                
                // console.log('BTN LAUNCH 30: ')
                $('#upgrade-price-modal').html('$30 per 6 months')
                $('#register-price-header').html('$30 per 6 months')
                
                // amount = {num:200, str:'2.00'} // test price
                amount = {num:3000, str:'30.00'}
                purchaseSite(30)
            })

            $('#btn-launch-50').click(function(e){
                if (e)
                    e.preventDefault()
                
                // console.log('BTN LAUNCH 50: ')
                $('#upgrade-price-modal').html('$50 per 12 months')
                $('#register-price-header').html('$50 per 12 months')

                // amount = {num:300, str:'3.00'} // test price
                amount = {num:5000, str:'50.00'}
                purchaseSite(50)
            })

            // checks if a template is ready when cloning:
            var checkTemplate = function(siteSlug){
                var body = {template:siteSlug}
                window.vertexLib.postRequest('/account/check-template', body, function(err, response){
                if (err){
                    // console.log('TEMPLATE NOT READY: ' + siteSlug)
                    setTimeout(function(){
                        checkTemplate(siteSlug)
                    }, 4000)
                    return
                }

                if (response.confirmation != 'success'){
                    setTimeout(function(){
                        checkTemplate(siteSlug)
                    }, 4000)
                    return
                }

                console.log('CHECK TEMPLATE: ' + JSON.stringify(response))
                if (response.confirmation != 'success'){
                    alert('Error - ' + response.message)
                    return
                }

                    window.location.href = '/admin/pages/'+siteSlug // redirect to site admin page
                })
            }

            var launchTemplate = function(name){
                console.log('LAUNCH TEMPLATE: ' + name)
                var body = {
                    // name: $('#input-site-name').val().trim(), // this needs to be entered by the user,
                    name: name,
                    source: template.id // ID of the template being copied
                }

                // console.log('launchTemplate: ' + JSON.stringify(body))
                window.vertexLib.postRequest('/account/launch-template', body, function(err, response){
                    if (err){
                        alert('Error: ' + err.message)
                        return
                    }

                    console.log('SITE LAUNCHED: ' + JSON.stringify(response))
                    setTimeout(function(){
                        checkTemplate(response.data.slug)
                    }, 4000)
                })
            }

            var paypalHandler = function(body){
                // console.log('SEND TO SERVER: ' + JSON.stringify(body)) // SEND TO SERVER: {"orderID":"6MY18367X92392056","payerID":"PHB8GZAU8N74Q"}
                $('#paypal-button-register').html('<img style="max-width:40%" src="https://storage.turbo360.co/vertex360-cms-4hujkc/loader.gif" /><br /><small>This may take a couple minutes...</small>')
                $.ajax({
                    url: '/paypal/launchtemplate',
                    type: 'POST',
                    data: body,
                    success: function(resp){
                        console.log('SUCCESS - ' + JSON.stringify(resp))
                        if (resp.confirmation != 'success'){
                            alert('Error - '+resp.message)
                            return
                        }

                        currentUser = resp.user
                        launchTemplate(currentUser.firstName) // charge processed, launch template:
                    },
                    error: function(resp){
                        console.log('ERROR - ' + JSON.stringify(resp))
                        alert('ERR - ' + resp.message)
                    }
                })
            }

            buttons.forEach(function(button){
                if (document.getElementById(button.id) != null){
                    paypal.Buttons({
                        onInit: function(data, actions){
                            if (button.type == 'register'){
                                actions.disable() // Disable the button until register fields are filled
                                $('#activate-pp-button').click(function(e){
                                    if (e)
                                        e.preventDefault()

                                    actions.enable()
                                })
                            }
                        },
                        style:{
                            size:   'large',
                            layout:  'horizontal',
                            color:   'blue',
                            shape:   'rect',
                            label:   'checkout'
                        },
                        onClick: function(data, actions){
                            // console.log('paypal button clicked!')
                            if (button.type != 'register'){
                                actions.resolve()
                                return
                            }
                            
                            // console.log('validate register fields.')
                            var visitor = {
                                fullName: $('#input-register-name').val(),
                                email: $('#input-register-email').val(),
                                password: $('#input-register-password').val()
                                // promoCode: $('#input-register-promo').val()
                            }

                            if (visitor.fullName.length == 0){
                                alert('Please enter your NAME')
                                return
                            }

                            if (visitor.email.length == 0){
                                alert('Please enter your EMAIL')
                                return
                            }

                            if (visitor.password.length == 0){
                                alert('Please enter your PASSWORD')
                                return
                            }

                            // activate the pp button:
                            document.getElementById('activate-pp-button').click()
                            actions.resolve()
                        },
                        createOrder: function(data, actions) {
                            return actions.order.create({
                                purchase_units: [{
                                    description: 'Launch template: '+template.name,
                                    amount: {
                                        value: amount.str
                                        // value: '2.00'
                                    }
                                }]
                            });
                        },
                        onApprove: function(data, actions) {
                            return actions.order.capture().then(function(details) {
                                console.log('Transaction completed by ' + details.payer.name.given_name);
                                if (button.type == 'register'){
                                    var visitor = {
                                        fullName: $('#input-register-name').val(),
                                        email: $('#input-register-email').val(),
                                        password: $('#input-register-password').val()
                                        // promoCode: $('#input-register-promo').val()
                                    }

                                    paypalHandler({
                                        type: button.type, // register or upgrade
                                        item: template.id,
                                        amount: amount.num,
                                        // amount: 200,
                                        orderID: data.orderID,
                                        user: JSON.stringify(visitor)
                                    })
                                }

                                if (button.type == 'currentuser'){
                                    paypalHandler({
                                        type: button.type, // register or upgrade
                                        item: template.id,
                                        amount: amount.num,
                                        // amount: 200,
                                        orderID: data.orderID,
                                        user: currentUser.id
                                    })                                    
                                }
                            });
                        }
                    }).render('#'+button.id)
                }
            })
        })()
    </script>

</body>

</html>
